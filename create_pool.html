<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ£Ø³ÛŒØ³ ØµÙ†Ø¯ÙˆÙ‚ Ø¬Ø¯ÛŒØ¯ | Ù¾Ù†Ù„ Ø§Ø¨Ø±ÛŒ</title>
    
    <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap');
        
        body { 
            font-family: 'Vazirmatn', sans-serif; 
            background: #fdfdfd;
            background-image: radial-gradient(#e2e8f0 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }

        .setup-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #f1f5f9;
        }

        /* Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ */
        input {
            text-align: right !important;
            direction: rtl !important;
        }

        /* ÙÛŒÙ„Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø¯ ØµÙ†Ø¯ÙˆÙ‚ Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„ (Ø§Ù…Ø§ Ú†Ø³Ø¨ÛŒØ¯Ù‡ Ø¨Ù‡ Ø±Ø§Ø³Øª) */
        #p-code, #m-mobile {
            direction: ltr !important;
            text-align: right !important;
        }

        .btn-tap { transition: all 0.2s ease; }
        .btn-tap:active { transform: scale(0.96); }

        .input-group:focus-within i { color: #4f46e5; }
        .input-group:focus-within input { background: white; border: 1px solid #4f46e5; }
        
        ::-webkit-scrollbar { display: none; }
    </style>
    
   
    
</head>
<body class="p-6">
    

    <div class="setup-card w-full max-w-sm p-10 rounded-[3.5rem] shadow-2xl shadow-slate-200/60">
        <!-- Ù„ÙˆÚ¯Ùˆ Ùˆ ØªÛŒØªØ± -->
        <div class="text-center mb-10">
            <div class="w-16 h-16 bg-indigo-600 rounded-3xl shadow-xl shadow-indigo-100 flex items-center justify-center text-white mx-auto mb-6 transform -rotate-6">
                <i class="fas fa-plus-circle text-2xl"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-800 tracking-tight">ØªØ£Ø³ÛŒØ³ ØµÙ†Ø¯ÙˆÙ‚ Ø¬Ø¯ÛŒØ¯</h2>
            <p class="text-[10px] text-slate-400 font-bold uppercase mt-1 tracking-widest">New Fund Deployment</p>
        </div>

        <div class="space-y-4">
            <!-- Ø¨Ø®Ø´ Ø§ÙˆÙ„: Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ -->
            <div class="space-y-3">
                <div class="relative input-group">
                    <input type="text" id="p-name" placeholder="Ù†Ø§Ù… ØµÙ†Ø¯ÙˆÙ‚ (Ù…Ø«Ù„Ø§ Ù…Ø±Ø§Ø¯ÛŒ)" 
                        class="w-full p-4 pr-12 bg-slate-50 border border-transparent rounded-[1.8rem] text-sm font-bold outline-none transition-all placeholder:text-slate-300">
                    <i class="fas fa-signature absolute right-5 top-5 text-slate-300 transition-colors"></i>
                </div>
                
                <div class="relative input-group">
                    <input type="text" id="p-code" placeholder="Ú©Ø¯ Ø§Ø®ØªØµØ§ØµÛŒ (ÙÙ‚Ø· Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)" 
                        class="w-full p-4 pr-12 bg-slate-50 border border-transparent rounded-[1.8rem] text-sm font-black outline-none transition-all placeholder:text-slate-300 uppercase tracking-widest">
                    <i class="fas fa-fingerprint absolute right-5 top-5 text-slate-300 transition-colors"></i>
                </div>
            </div>

            <div class="flex items-center gap-2 py-2">
                <div class="flex-1 h-px bg-slate-100"></div>
                <span class="text-[8px] text-slate-300 font-black uppercase tracking-widest">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„</span>
                <div class="flex-1 h-px bg-slate-100"></div>
            </div>

            <!-- Ø¨Ø®Ø´ Ø¯ÙˆÙ…: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¯ÛŒØ± -->
            <div class="space-y-3">
                <div class="relative input-group">
                    <input type="text" id="m-name" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ " 
                        class="w-full p-4 pr-12 bg-slate-50 border border-transparent rounded-[1.8rem] text-sm font-bold outline-none transition-all placeholder:text-slate-300">
                    <i class="fas fa-user-tie absolute right-5 top-5 text-slate-300 transition-colors"></i>
                </div>
                
                <div class="relative input-group">
                    <input type="tel" id="m-mobile" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ " 
                        class="w-full p-4 pr-12 bg-slate-50 border border-transparent rounded-[1.8rem] text-sm font-black outline-none transition-all placeholder:text-slate-300">
                    <i class="fas fa-phone-alt absolute right-5 top-5 text-slate-300 transition-colors"></i>
                </div>
                
                <div class="relative input-group">
                    <input type="password" id="m-pass" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ±" 
                        class="w-full p-4 pr-12 bg-slate-50 border border-transparent rounded-[1.8rem] text-sm font-black outline-none transition-all placeholder:text-slate-300">
                    <i class="fas fa-lock absolute right-5 top-5 text-slate-300 transition-colors"></i>
                </div>
            </div>

            <!-- Ø¯Ú©Ù…Ù‡ Ø³Ø§Ø®Øª -->
            <button onclick="createNewPool()" id="create-btn" 
                class="btn-tap w-full bg-slate-900 text-white py-4 rounded-[1.8rem] font-black text-sm shadow-xl shadow-slate-200 mt-4 flex items-center justify-center gap-2">
                <span>ØªØ§ÛŒÛŒØ¯ Ùˆ Ø³Ø§Ø®Øª Ù†Ù‡Ø§ÛŒÛŒ</span>
                <i class="fas fa-check-circle text-xs opacity-50"></i>
            </button>
            
            <p class="text-center mt-4">
                <a href="login.html" class="text-[10px] font-black text-slate-400 hover:text-indigo-600 transition-colors uppercase tracking-widest">ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</a>
            </p>
        </div>
        <!-- Ø§Ù…Ø¶Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ Ø§Ø¯ÛŒØ³ÙˆÙ† -->
<div class="mt-10 text-center">
    <p class="text-[9px] font-black text-slate-400 uppercase tracking-[0.3em] opacity-70">
        Designed & Developed by <span class="text-indigo-600">EDDIE</span>
    </p>
</div>
    </div>

    <script>
        // --- Ù„Ø§ÛŒÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ø¶Ø§ ---
(function() {
    // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù‚Ø¨Ù„Ø§Ù‹ Ú©Ø³ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ú¯ÙˆØ´ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ÛŒØ§ Ù†Ù‡
    const isMember = localStorage.getItem('user_id') || localStorage.getItem('pool_id');
    
    // Ø§Ú¯Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ø¶ÙˆÛŒØª ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªØŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø±Ùˆ Ø¨Ù‡ ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ†
    if (isMember) {
        window.location.replace('login.html');
    }
})();
// --------------------------

        
        const SUPABASE_URL = 'https://kqnsbnpznkwkwukzokik.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_ZqXeccdaSzZUivCwU38WcQ_m05uT4y6';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function createNewPool() {
            const pName = document.getElementById('p-name').value.trim();
            const pCode = document.getElementById('p-code').value.trim().toUpperCase();
            const mName = document.getElementById('m-name').value.trim();
            const mMobile = document.getElementById('m-mobile').value.trim();
            const mPass = document.getElementById('m-pass').value.trim();
            const btn = document.getElementById('create-btn');

            if(!pName || !pCode || !mName || !mMobile || !mPass) return alert("Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯ âŒ");

            btn.disabled = true;
            btn.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ (Ù…Ø±Ø­Ù„Ù‡ Û±)...";

            try {
                // Û±. Ø³Ø§Ø®Øª ØµÙ†Ø¯ÙˆÙ‚
                const { data: poolData, error: pErr } = await supabaseClient
                    .from('pools')
                    .insert([{ pool_name: pName, pool_code: pCode }])
                    .select();

                if (pErr) throw new Error("Ú©Ø¯ ØµÙ†Ø¯ÙˆÙ‚ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª ÛŒØ§ Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø±Ø® Ø¯Ø§Ø¯.");
                
                const newPoolId = poolData[0].id;
                btn.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ (Ù…Ø±Ø­Ù„Ù‡ Û²)...";

                // Û². ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
                const { error: sErr } = await supabaseClient
                    .from('settings')
                    .insert([{ pool_id: newPoolId, base_amount: 2000000, won_amount: 2500000 }]);
                if (sErr) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡.");
                
                btn.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ (Ù…Ø±Ø­Ù„Ù‡ Û³)...";

                // Û³. Ø«Ø¨Øª Ù…Ø¯ÛŒØ±
                const { error: mErr } = await supabaseClient
                    .from('members')
                    .insert([{ 
                        pool_id: newPoolId, full_name: mName, mobile: mMobile, 
                        password: mPass, is_admin: true, is_super_admin: false,
                        total_shares: 1, won_shares: 0, has_won: false, credit_score: 100
                    }]);
                if (mErr) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¯ÛŒØ±.");

                alert(`ğŸ‰ Ø¹Ø§Ù„ÛŒ Ø´Ø¯! ØµÙ†Ø¯ÙˆÙ‚ "${pName}" Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯.`);
                
                btn.innerText = "ØµÙ†Ø¯ÙˆÙ‚ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ø› Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯";
                btn.classList.replace('bg-slate-900', 'bg-emerald-600');
                btn.disabled = false;
                btn.onclick = () => window.location.replace('./login.html');
                
                setTimeout(() => window.location.replace('./login.html'), 1500);

            } catch (err) {
                alert("ğŸš¨ Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯: \n" + err.message);
                btn.disabled = false;
                btn.innerText = "ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯";
            }
        }
    </script>
</body>
</html>
